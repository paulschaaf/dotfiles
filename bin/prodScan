#!/usr/bin/env zsh
products=(bc cc ab pc pl)
platform=halite

switches=()
alias dry_run=false
while [[ -n "$*" ]]; do
   switch=${1%%=*}; [[ ${switch} =~ "=" ]] && value=${1#*=} || value=''
   case ${switch} in
      --debug)
         set -x
         ;;
      --dry_run|--dry-run)
         alias dry_run=true
         ;;
      --platform)
        platform=$value
        ;;
#      -h|--help)
#         usage
#         exit
#         ;;
      --ab|--bc|--cc|--pc|--pl)
        product=${switch##--}
        # either add the product (e.g. "ab=ab", or remap the product (e.g. "Cc"="cc2")
        products[$products[(i)${product}]]=${value:=$product}
        ;;
      --none)
        products=()
        ;;
      --no*)
        badprod=${switch##--no}
        # remove the offending product
        products[$products[(i)$badprod]]=()
        ;;
      -*)
        switches+=(${1})
       ;;
      *)
        break
        ;;
   esac
   shift
done

cd ~/gw/$platform

for prod in $products; do
  name=`sed -n 's/^appName=/ /gp' $prod/gradle.properties`
  printf "\n\e[1;46m%s%$(($COLUMNS-$#name))s\e[0m\n" $name "${PWD//$HOME/~}/$prod"
  rg --color=always --case-sensitive ${switches} ${*} $prod
done
