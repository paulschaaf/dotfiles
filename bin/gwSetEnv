#!/bin/bash
#set -x
unset GW_PLATFORM
setScreenTitle () {
    echo -n "\ek$*\e\\"
}
case $PWD in
    */carbon/*)
        export GW_PLATFORM=carbon
        export GW_PL_NUM=6
        ;;
    */diamond/*)
        export GW_PLATFORM=diamond
        export GW_PL_NUM=7
        ;;
    */emerald/*)
        export GW_PLATFORM=emerald
        export GW_PL_NUM=8
        ;;
    */ferrite/*)
        export GW_PLATFORM=ferrite
        export GW_PL_NUM=9
        ;;
    */granite/*)
        export GW_PL_NUM=10
        export GW_PLATFORM=granite
        ;;
   *)
        echo "~${0##$HOME}: Could not determine platform version!" >&2
        unset GW_COLOR GW_PL GW_PLATFORM GW_PRODUCT GW_START_SCRIPT GW_TITLE
        ;;
esac

if [ -n $GW_PL_NUM ]; then
    export GW_PRODUCT=`echo $PWD | sed "s_^.*/${GW_PLATFORM}/\([^/]*\).*_\1_"`

    # # take the uppercase of the first char
    export GW_PL=`echo $GW_PLATFORM | sed 's/\(.\).*/\U\1/'`
    export GW_TITLE="$GW_PL:$GW_PRODUCT"

    case `uname` in
        CYGWIN*)
            _script_extension=.bat
            ;;
        *)
            if [ "$GW_PLATFORM" = "ferrite" ]; then
                _script_extension=
            else
                _script_extension=.sh
            fi
            ;;
    esac

    # setJavaHomeTo() {
    #     local newHomeName=$1
    #     eval local newHome=\$$newHomeName

    #     if [ "$newHome" = "" ]; then
    #         echo Error: $newHomeName is not set\!
    #     elif [ ! -d ${newHome} ]; then
    #         echo Error: $newHomeName directory $newHome does not exist\!
    #     fi
    #     export JAVA_HOME=$newHome
    # }

    export GW_START_SCRIPT=./gwb
    export IDEA_HOME=$IDEA15_HOME
    export JAVA_HOME=$JAVA8_HOME

    case $GW_PL_NUM in
        6)
            export GW_START_SCRIPT=bin/$GW_PRODUCT${_script_extension}
            export IDEA_HOME=$IDEA11_HOME
            export JAVA_HOME=$JAVA6_HOME_x86
            ;;
        7)
            export GW_START_SCRIPT=bin/$GW_PRODUCT${_script_extension}
            export IDEA_HOME=$IDEA12_HOME
            export JAVA_HOME=$JAVA6_HOME
            ;;
        8)
            export GW_START_SCRIPT=bin/$GW_PRODUCT${_script_extension}
            export IDEA_HOME=$IDEA12_HOME
            export JAVA_HOME=$JAVA7_HOME
            ;;
        9)
            export IDEA_HOME=$IDEA15_HOME
            export JAVA_HOME=$JAVA8_HOME
            ;;
        10)
            export IDEA_HOME=$IDEA15_HOME
            export IDEA_JDK=${JAVA8_HOME}_nodcevm
            export JAVA_HOME=$JAVA8_HOME
            ;;
        *)
            ;;
    esac

    _lib_jars='./lib/*jar'
    CLASSPATH=$JAVA_HOME/lib/\*jar:$_lib_jars:${CLASSPATH}

    # Remove any empty or duplicate members
    CLASSPATH=`echo -n $CLASSPATH | awk -v RS=: '{ if (!arr[$0]++) {printf("%s%s", ln++ ? ":" : "", $0)}}'`

    typeset AARDVARK_HOME ANT_HOME M2_HOME IDEA_HOME JAVA_HOME
    echo

    export PATH=${JAVA_HOME}/bin:${IDEA_HOME}/bin:${PATH}

    java -version

    case $GW_PRODUCT in
        ab|ContactManager)
            # bright white text on aqua
            $ifCygwin export GW_COLOR=3F
            export GW_PORT=8280
            export GW_PORT_DEBUG=8290
            ;;
        bc|BillingCenter)
            # bright white text on red
            $ifCygwin export GW_COLOR=2F
            export GW_PORT=8080
            export GW_PORT_DEBUG=8090
            ;;
        cc|ClaimCenter)
            # bright white text on blue
            $ifCygwin export GW_COLOR=1F
            export GW_PORT=8080
            export GW_PORT_DEBUG=8090
            ;;
        pc|PolicyCenter)
            # bright white text on red
            $ifCygwin xport GW_COLOR=4F
            export GW_PORT=8080
            export GW_PORT_DEBUG=8090
            ;;
        *)
            $ifCygwin export GW_COLOR=0F
            ;;
    esac

    $ifCygwin typeset -p GW_COLOR | sed 's/^typeset \(-x \)*//g'
    typeset GW_PL GW_PLATFORM GW_PRODUCT GW_START_SCRIPT GW_TITLE
    function echoList() {
        for arg in $*; do
            echo -e "\n$arg contains:"
            eval echo \${${arg}} | tr ':' '\n' | cat -n
        done
    }

    echoList PATH CLASSPATH

    # this will only work if you 'source' this file
    setScreenTitle $GW_TITLE
fi
