Blogger <http://www.blogger.com/>
Get your own blog <http://www.blogger.com/>Next blog
<http://www.blogger.com/redirect/next_blog.pyra?navBar=true>
BlogThis! <javascript:BlogThis();>


  Chris Justus - Server Side Guy <http://serversideguy.blogspot.com>

A discussion about server side programming (particularly, but not
exclusively related to Java), plus other bits about the software
development life cycle, quality assurance / bug tracking, the IT
industry, and life in general...


    Tuesday, December 14, 2004


      Google Suggest Dissected...

People have been contributing their two cents to how this works, but I
have un-compressed (ie. re-written) Google's compressed javascript, so
that the average web developer should be able to get a detailed
understanding of how this works.... My final rewrite is available from
my website here <http://www.fastbugtrack.com/misc/google/ac.js>.

I saw the coolest thing I've seen since realizing that Mozilla was
embedding a wsdl-enabled SOAP client into this browser... Google Suggest
returns suggested results as you type... This is technically amazing on
about at least two different levels:


   1. How fast this is... I type pretty fast, and it updates with every
      single keypress...
   2. The cool web interface... I used to be pro-server side web
      updates, and avoiding javascript, but I'm really turning around on
      this with the impressive interfaces I've seen with gmail, and now
      google suggest (among others...)



So everyone is impressed by this... My shock and awe goes further in
terms of how nice this interface works:


   1. That the suggestion list lines up perfectly with the query input
      field...
   2. The high-lighting of the additionally suggested text (I type "fa",
      it suggests "fast bugtrack" and highlights the "st bugtrack" so
      that the next character I type wipes out it's suggestion...
      beautiful...)
   3. The great handling of keypresses (cursors up and down...)
      And After going through googles code:
   4. How the javascript cache's the dynamic results so that if you
      backspace, it doesn't have to go back to google...
   5. How the code dynamically adjusts it's main (time/alarm) driven
      loop based on how quickly you're getting results back from google...



So I wanted to understand the web interface and it's dynamic
interface... Just a note that the good and brilliant folks at google
wrote all of the code we'll be looking at here this evening... I didn't
write any of it, but I will be stepping through it with you, and
hopefully helping to improve everyone's understanding of this great
dynamic web interface...

A couple of tips for how I went about reversing the logic here:


   1. I saved the html and javascript locally... I managed to get a
      local copy running, and placed some alerts into the code to
      observe behaviour as well as using the javascript console to catch
      places I made mistakes renaming variables and functions...
   2. The google code uses an XMLHttp object to make calls back to
      google, and executing the results... to fully understand the code,
      I need to see what google is sending back... BUT when I tried the
      url directly, I didn't get anything but a 404 back from google (it
      turns out I had mis-typed the generated url...)... I tried to have
      my browser go through a local proxy server, but it appears that
      the XMLHttp object doesn't use the browsers proxy when
      communicating (which means that this might not work if you're
      behind a proxy server... Can people confirm this??) ... I would
      have fallen back on a packet sniffer to capture the data, but
      caught my mistake in the URL before reaching this point...



Looking at the main page source, just go to google and view source...
<http://www.google.com/webhp?complete=1&hl=en> At the bottom of this
file, we can see a reference to javascript which drives the dynamic
interaface (available directly from google here
<http://www.google.com/ac.js>...)

The good folks at google compress their code as they should, so in order
to understand it, I first re-indented it as can be seen here
<http://www.fastbugtrack.com/misc/google/acIndent.js>... Then I began
the fun process of figuring out what the global variables are for, and
what the various functions do, and renaming them to meaningful names...
I made it pretty far as can be seen in my final re-write of Google's
suggest javascript codehere <http://www.fastbugtrack.com/misc/google/ac.js>

Things I didn't know before this exercise that I learned going through
this...
1) You can turn the browsers autocomplete off by adding
autocomplete="off" attribute to an input field... How did I not know
this before...
2) The XMLHTTP / XMLHttpRequest object to communicate back with a server
and get new info / instructions without refreshing the page ... the new
black of web development... go read everything you can about this...
3) How powerful the keypress handling can be with javascript...
(capturing keyup/keydown and events and changing state for cursor key
events, etc...)
4) You can highlight text in an input field using javascript...


Stepping through it:

The html page calls InstallAC()...
This set's up the system... An interesting line:
var Jb="zh-CN|zh-TW|ja|ko|vi|";
So while they say they support English only, there is definitely code
that looks for locales in Japan, Korea, and China and handle requests
appropriately...

The installAC function calls another function (I called
installACPart2)... This function checks that our browser supports
XMLHttp, creates what I call the "_completeDiv" ... the DIV inwhich
google suggestions will be populated when we get data back from
google... It uses absolute positioning to line it up with the input text
field, and is intially hidden...
The installACPart2 function also sets up some keydown and resize event
handlers...It also begins the creation of the url for which we will be
making our dynamic requests to google...

The function I called mainLoop sets itself up to be called repeatedly
using the javascript setTimeout function... It's interesting to note
that the designers decided to use this timeout based mechanism rather
than the keydown mechanism... This would handle fast typers on slow
connections (so if I typed 3 characters between timeouts, a single
request would go out to google...) The mainLoop checks if the state of
the input field has changed and if so, takes action - looking first in
the result cache, then making a call out to google... The google
suggestion code also handles older browsers that don't have an XMLHttp
object by using cookies and frame reloading (I haven't tried this yet...)

The callGoogle routine is fairly straight-forward... I makes calls of
the format (if I am in an English locale, and have typed "fast bug"):
http://www.google.com/complete/search?hl=en&js=true&qu=fast%20bug
It sets up a callback _xmlHttp.onchange event function, that will simply
evaluate the (what ends up being a javascript funciton) that gets
returned from google...
What gets sent back looks like this:

sendRPCDone(frameElement, "fast bug", new Array("fast bug track", "fast
bugs", "fast bug", "fast bugtrack"), new Array("793,000 results",
"2,040,000 results", "6,000,000 results", "7,910 results"), new Array(""));

The sendRPCDone function is defined in the ac.js file... It adjusts
timing in the mainloop, caches the results received, sets up the
_completeDiv DIV with the result arrays, and ultimately ends up
displaying this DIV....

The function displaySuggestedList takes the results and dynamically
creates a series of DIV and SPAN data structures (using the DOM model)
that ultimately form the suggestion list that gets displayed... For each
element in our list, our data structure looks something like: (where (x)
is the variable in the code)

<DIV (u) - mousedown/mouseover/mouseout class="aAutoComplete">
<SPAN (ka) class="lAutoComplete">
<SPAN (ua) class="cAutoComplete">
bug tracking
</SPAN (ua)>
<SPAN (ea) class="dAutoComplete">
500,000 results
</SPAN (ea)>
</SPAN>
</DIV (u)>


The Pa() function [I never came up with a satifactory name] gets called
when results are received and whenever a key is pressed (and perhaps on
some of the mouse events as well(?)... It does the high-lighting of text
that we didn't type...

You'll want to look over and step through the code yourself to truly
understand it... Let me know if you have any questions or comments...
There is a good chance that I made a typo or two as I renamed things...

/posted by Chris at 1:05 AM
<http://serversideguy.blogspot.com/2004/12/google-suggest-dissected.html>/


        102 Comments:

Anonymous said...

    Thanks for your work!

    2:56 AM <#110301097302056140>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110301097302056140>

Anonymous said...

    I know, what you have done is useful to many people and will help
    improve the usability of many rich webapps, but are you sure about
    legality of re-publishing Google copyrighted code?

    Few months ago, I did a similar exercise with gmail JavaScript code
    and was tempted to publish the un-compressed code, but then better
    sense prevailed.

    12:12 PM <#110304432879400244>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110304432879400244>

sri <http://www.blogger.com/profile/4357153> said...

    Great sleuthing! BTW, it works behind a proxy server.

    12:55 PM <#110313334841871381>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110313334841871381>

Anonymous said...

    Wonder what they did on the server side to make the response time so
    quick. That is an AMAZINGLY fast reponse time for data over the
    web....not to mention the fact that it comes out of a database of
    some sort.

    2:13 PM <#110313801160931255>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110313801160931255>

Anonymous said...

    Well Done Chris, thanks for making me know this service and its
    internals.
    Tamer Salama
    http://www.jroller.com/page/tamer

    2:24 PM <#110313864051996119>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110313864051996119>

Anonymous said...

    You just got slashdotted.

    4:13 AM <#110336120590918968>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336120590918968>

Anonymous said...

    When do you start work for Google? ;-)

    4:15 AM <#110336133786105201>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336133786105201>

Anonymous said...

    It works behind a proxy.

    4:36 AM <#110336257007951220>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336257007951220>

Donny <http://www.blogger.com/profile/5199194> said...

    "The google suggestion code also handles older browsers that don't
    have an XMLHttp object by using cookies and frame reloading"

    Man, I just love how Opera 7.6 falls into this category ;) I don't
    get these folks, they add so much bullshit crap to opera but can't
    add something which is becomming so usefull these days.

    4:38 AM <#110336270725572919>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336270725572919>

Anonymous said...

    Dunstan Orchard has had this on his site
    <http://www.blogger.com/r?http%3A%2F%2F1976design.com%2Fblog> for a
    while: see the LiveSearch box.

    4:40 AM <#110336280965847627>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336280965847627>

Anonymous said...

    Great job. Even greater that shared your findings.

    4:47 AM <#110336325032666545>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336325032666545>

Anonymous said...

    I can't confirm your "It looks like it won't work behind a proxy".

    It works behind a proxy.

    I even made some tcpdump and I can reply it with telnet.

    See: http://www.megabot.nl/public/googledump.txt

    4:48 AM <#110336331398625303>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336331398625303>

Anonymous said...

    Now is only someone can disect the code used at amazons www.a9.com
    to dynamically resize table columns.

    4:54 AM <#110336367703078455>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336367703078455>

Anonymous said...

    Great job
    .. and don't worry about the legal side of things: JS and html code
    is just not meant to be private!

    5:19 AM <#110336516653549267>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336516653549267>

lav-chan <http://www.blogger.com/profile/5250522> said...

    This post has been removed by the author.

    5:53 AM <#110336721481229801>
lav-chan <http://www.blogger.com/profile/5250522> said...

    /Man, I just love how Opera 7.6 falls into this category ;) I don't
    get these folks, they add so much bullshit crap to opera but can't
    add something which is becomming so usefull these days./Er, i
    haven't used 7.6 yet (still on 7.54), but i thought that was one of
    the main points in releasing 7.6 -- they added the XMLHttp stuff
    which is required for Gmail to work. :/

    Actually, Google Suggest (the real one) works fine for me in Opera
    (7.54), so.... (ps blogger sux)

    5:55 AM <#110336732716568729>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336732716568729>

Anonymous said...

    Nice stuff. Thanks for sharing ^^

    6:05 AM <#110336792721794428>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336792721794428>

Anonymous said...

    Chris... Great job. What a pain it would have been to rename all
    those functions, but you did an A+ job and I will be going over the
    code tomorrow.

    Thanks!

    Ryan
    Toronto, Ontario, Canada

    6:18 AM <#110336872241017548>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110336872241017548>

Anonymous said...

    If you'd used the excellent LiveHTTPHeaders extension to Firefox
    you'd see all calls from your browser to Google's serverside script
    and you could easily see what google sent back to your browser.

    6:52 AM <#110337076520183514>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337076520183514>

Afox <http://www.blogger.com/profile/5821300> said...

    Very nice dissection! Saw it on SlashDot and it is very intruiging!

    6:56 AM <#110337099064843809>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337099064843809>

Anonymous said...

    >are you sure about legality of re-publishing Google copyrighted code?

    It is a sad state when the media has so demonised internet piracy
    that people are afraid to do anything. The fundamental basis behind
    copyright is that it protects *EXPRESSION*, not *IDEAS*. Thus you
    can attempt stuff like Wind Done Gone but not reprint Gone With the
    Wind. There are also other criteria such as creativity etc but I
    won't go into the boring specifics. Also different jurisdictions
    have different exemptions, for example US Fair Use or Commonwealth
    Fair Dealings.

    In short, a technical commentary which addresses a completely
    different market from intended, with reverse engineering to create
    similar functionality but expressed differently is probably legit
    [IANAL] depending on the precise jurisdiction. There may be mutters
    about theft of service or other forms of economic torts in abusing
    the google web server but that's a different issue
    --
    LegalEaglet

    7:17 AM <#110337224824309798>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337224824309798>

Anonymous said...

    Informative... thanks for sharing.

    Azmeen
    <http://www.blogger.com/r?http%3A%2F%2Fwww.supersuccessdynamics.com.my>

    7:25 AM <#110337273637900697>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337273637900697>

Anonymous said...

    pretty good stuff..
    btw here the url for the google autocomplete dropdown

    http://www.google.com/complete/search?hl=en&js=true&qu=java

    The last one is the actual term.

    check it out.
    thanks
    Murali Varadarajan

    7:34 AM <#110337326629660814>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337326629660814>

xantus <http://www.blogger.com/profile/5859340> said...

    I figured out the autocomplete last week and came up with my own
    version for CPAN. Take a look! CPAN Search with Autocomplete
    <http://www.blogger.com/r?http%3A%2F%2Fteknikill.net%2Fcpan%2F>

    7:41 AM <#110337368767129208>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337368767129208>

Anonymous said...

    I just love JavaScript! :)

    / MackanZoor

    7:44 AM <#110337386509070905>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337386509070905>

Richard Soderberg <http://www.blogger.com/profile/3223867> said...

    "Pa" could be "ParseRPCAnswer()".

    7:54 AM <#110337447075008605>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337447075008605>

Doekman <http://www.blogger.com/profile/5859422> said...

    You finished what I also started with. I was just in the proces of
    commenting and renaming functions, after indenting all javascript by
    hand (does anyone know a decent reformatter for javascript?). But
    thanks, I couldn't have done such a thorough job as you did.

    Anyways, you won't get an answer from Google when submitting the
    XmlHttpRequest, because of browser security. Like with cookies, it's
    only legal to issue requests to the same domain as the webpage
    itself. Basically, you only can specify a relative path as URL.

    The way around this is to create a request forwarder server-side...

    8:21 AM <#110337611108653986>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337611108653986>

Doekman <http://www.blogger.com/profile/5859422> said...

    And the XMLHttpRequest does go through the http proxy in Safari,
    Firefox (Mac) and IE6 on Windows (I used netmon to verify), but that
    was not the problem...

    8:31 AM <#110337671915913325>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337671915913325>

Anonymous said...

    This post has been removed by a blog administrator.

    8:32 AM <#110337676474988020>
Anonymous said...

    > There is a good chance that I made a typo or two as I
    > renamed things...

    With all due respect, your posting would be even more
    impressive and credible if you would bear in mind that
    words like "its" and "caches" do not have apostrophes
    in them.

    8:34 AM <#110337687014895287>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337687014895287>

Anonymous said...

    Does Google Suggest prove that Google is using alien technology from
    the future?

    9:15 AM <#110337935217880253>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337935217880253>

Anonymous said...

    Not to get to far off topic, but "its" does in fact sometimes use an
    apostrophe -- "It's" is the contraction for "It is."

    Great work! I've certainly found this to be most interesting!

    9:16 AM <#110337937787430619>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110337937787430619>

Anonymous said...

    I...think you put dots...where they don't really belong...they add
    nothing but show how poorly...you write.

    -nb

    9:56 AM <#110338178296702189>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338178296702189>

Anonymous said...

    Fiddler (http://www.fiddlertool.com) would save you a lot of time as
    you were trying to determine what you were sending up and Google was
    sending back.

    10:12 AM <#110338276253771520>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338276253771520>

Anonymous said...

    Guys, chill on the grammar. He *is* Canadian.

    :)

    10:13 AM <#110338282232288522>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338282232288522>

Anonymous said...

    For your next task - adapt the Javascript to a Firefox search bar.

    10:22 AM <#110338337088697581>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338337088697581>

Nadeeshyama <http://www.blogger.com/profile/5861018> said...

    Google has definitely shown the power of Javascript with its Gmail.
    And here they go again with Google Suggest!

    You have done a nice job explaining what goes 'behind the screen'.

    10:43 AM <#110338458587986407>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338458587986407>

Anonymous said...

    Check this out
    http://www.innuvo.com/

    10:44 AM <#110338464017364179>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338464017364179>

Anonymous said...

    Well done, very useful - it appears that Google is using some kind
    of Trie data structure at the server side, which is what's giving
    them such fast response times - for more info see here:
    http://c2.com/cgi/wiki?StringTrie

    11:03 AM <#110338580851095482>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338580851095482>

Anonymous said...

    mmmmm I would really love this for firefox google box.

    11:07 AM <#110338604978401785>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338604978401785>

Anonymous said...

    I haven't checked, but it wouldn't surprise me if they were using a
    compressed content attribute on the XML HTTP stream; that makes the
    rendering of web downloads quite impressive.

    11:27 AM <#110338727258534981>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338727258534981>

Jeremy <http://www.blogger.com/profile/5311502> said...

    Great Work!!!

    I have worked a lot with XMLHttp Object and It does wonders. I use
    it in 85% of my applications.

    Some examples:

    1. Credit Card Payments
    2. Checking for Availability (Hotel Rooms, Properties etc..)
    3. Sending/Getting Data to and from Database

    Try it when ever you can, It's really fast.

    11:31 AM <#110338748468037461>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338748468037461>

Kord <http://www.blogger.com/profile/2622955> said...

    Yeah, that XMLHttpRequest stuff is good stuff. We use it on our site
    at Zoto <http://www.blogger.com/r?http%3A%2F%2Fzoto.com> to send
    back tag updates on photos without reloading the page.

    At the time we implemented it, Opera didn't support the request
    call, so our web dev guy hacked up a function that emulated it for
    Opera using image requests.

    Nice analysis of the script BTW. Kind of makes you wonder if it's
    worth obfuscating the code....

    11:37 AM <#110338786080036352>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338786080036352>

Anonymous said...

    What we need now is for someone to build (and sell us?) a simple
    toolkit that provides this functionality for those of use who don't
    want to use this in our apps.

    Whoever does this please provide implementation for the following:
    Coldfusion, JSP, JSF, ASP, PHP.

    I'd buy such a component right now (for say, $30 bucks?).

    11:48 AM <#110338851466493423>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338851466493423>

Anonymous said...

    Learn how to use apostrophes correctly!

    http://kubed.org/archives/2004/12/07/apostrophe-abuse/trackback/

    11:55 AM <#110338891815637684>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338891815637684>

Anonymous said...

    FYI: Google Suggest works from behind the proxy server / firewall in
    my company.

    12:08 PM <#110338969934639625>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110338969934639625>

Anonymous said...

    Great Job,

    I'm glad you see the value in getting new data without a new page
    request. This just highlights how incorrect normal web developer
    assumptions can be. That the heavy lifing is reserved for the server
    side while JavaScript handles only form validation and saying "Good
    Morning".

    The new black indeed!

    Ken

    12:15 PM <#110339014445681296>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339014445681296>

Anonymous said...

    Please proofread this, or have it proofread. I'm probably more
    peevish about this than most people, but I couldn't finish it with
    all the inappropriate uses of apostrophes. Thanks.

    12:49 PM <#110339219250382260>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339219250382260>

Anonymous said...

    > Nice analysis of the script BTW. Kind of makes you wonder if it's
    worth obfuscating the code....

    i'm guessing google uses funny short variable names not to
    obfuscate, but to compress the data so it gets to your computer faster.

    1:21 PM <#110339411476309893>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339411476309893>

bloodnok <http://www.blogger.com/profile/3918568> said...

    the possessive form of "it" is "its". "it's" is a contraction of "it
    is".

    2:07 PM <#110339685302385963>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339685302385963>

Anonymous said...

    thank you very much for the work. this same idea for dynamic
    shrinking of the search term space was in a pre-internet CDROM
    product called Computer Select. it was a collection of all the
    articles from PCWeek, PCMagazine, etc. etc. and it was really nice
    to be prompted for product model names, company names, etc. as they
    were typed into the search interface.

    i've been dying to see it show up on the web.

    2:16 PM <#110339741637497880>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339741637497880>

"-" <http://www.blogger.com/profile/1282411> said...

    Nice work.

    If you'd like a Gmail invite, let me know.

    I'd love to see the same analysis of that.

    Some things in Gmail work just as nicely as Google Suggest.

    "-"

    2:47 PM <#110339922077725889>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110339922077725889>

Anonymous said...

    Great work!
    Well done...
    Joe.

    3:13 PM <#110340080567359720>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340080567359720>

Anonymous said...

    Yeah, but check out this: http://aminaked.com/poker
    And another thing, Google Suggest is cool and also completely useless.

    3:43 PM <#110340260561332960>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340260561332960>

Anonymous said...

    Thanks for sharing!

    4:16 PM <#110340459931677225>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340459931677225>

Anonymous said...

    var Jb="zh-CN|zh-TW|ja|ko|vi|";

    The line above is more than for just Chinese, Japanese and Korean.
    It covers Simplified Chinese (used in mainland China), Traditional
    Chinese (used in Taiwan and Hong Kong), Japanese, Korean and Vietnamese.

    4:26 PM <#110340521731225082>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340521731225082>

Anonymous said...

    grammar nazis back off. this is a blog. that means anyone can write
    any which way they please. it's not formal. wait! its not formal
    (j/k :P).

    this is not a white paper on the inner workings of google. this is
    his analysis posted to his blog so technical people who want know
    how google works can have a peek. this is not for english
    professors. can you understand the explanation? if yes, then shut
    up. if not, then might i suggest a bunch of "x for dummies" books?
    buy javascript for dummies and internet for dummies and http for
    dummies and even xmlhttp for dummies (although msdn does a nice
    enough job of it for their version of this).

    let the man speak. he's not here to win an elite english writing
    prize. sheesh, if you don't understand the technical stuff stay
    away. if you do understand the technical stuff, well that is the
    purpose of this blog entry.

    * most punctuation intentionally omitted for your temperament.

    5:09 PM <#110340778791037340>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340778791037340>

Anonymous said...

    The XMLHttpRequest object is one of the best discoveries I have made
    in Javascript this year. I've been using it like this for a few
    months, now, and it does wonders for making 'application like' web
    sites.

    Being able to reload small portions of a web page is great for
    saving bandwidth and server usage too...

    5:35 PM <#110340935008915961>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110340935008915961>

Anonymous said...

    Nice to see people discovering the XMLHTTP component. I've been
    using this technique for over three years (via the XMLHTTP component
    and other methods).

    8:41 PM <#110342047894571522>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110342047894571522>

Anonymous said...

    Interesting article, but PLEASE learn to write without using the
    ellipsis. It's a crutch; and at the rate you use them, it's distracting.

    10:01 PM <#110342530523158169>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110342530523158169>

Anonymous said...

    >Guys, chill on the grammar. He *is* Canadian.

    heh, and I guess you're from the USA, a place well known for its
    strict use of the English language... oh hang on, that's right you
    guys just made up your own bastardised version. BTW I'm from
    Australia, where we is all real good wiff riten n stuff :)

    10:41 PM <#110342768272820160>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110342768272820160>

Anonymous said...

    Pretty nice stuff, I wanted to see if i can make it into behavior
    and it works out pretty nicely. anyone who wants the .htc file can
    email me at junk.huskies@gmail.com

    11:06 PM <#110342919218112295>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110342919218112295>

Anonymous said...

    Grat to see people using the XmlHttp component. I personally
    invented it 18 years ago (and three months or so)

    12:32 AM <#110343433242166967>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110343433242166967>

Anonymous said...

    I personally invented it 20 years ago, on an Alto, in assembler,
    over BITNET.

    12:37 AM <#110343467797787974>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110343467797787974>

Anonymous said...

    For those curious about the language support -- I posted a much
    higher-level analysis of this feature when it was first discussed on
    Slashdot, and got dozens of responses confirming my guess about
    suprisingly wide language support (even though Google's FAQ
    apparently says something about adding support for other languages
    later).

    Details here.
    <http://www.blogger.com/r?http%3A%2F%2Fslashdot.org%2Fcomments.pl%3Fsid%3D132312%26cid%3D11053245>

    3:05 AM <#110344352387360539>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110344352387360539>

Anonymous said...

    xmlhttprequest object is first developed by Microsoft, not mozilla.
    Basically it is due to Microsoft's efforts to extend basic web
    technologies, we have google and other companies implementing such
    technologies. If it was left to Microsoft bashers, we clearly
    wouldn't have these services today. Just a quick observation who is
    really behind the web.

    6:17 AM <#110345505909021257>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110345505909021257>

Anonymous said...

    don't forget to take out the alert on line 686.

    other than that, its pretty slick when it gets working. very fast,
    and very clever.

    but i wish there was an easy way to identify a primary key with the
    dynamic menu selection - but google uses v.value for copying,
    instead of indicies which could be extracted via dom.. bit of a
    bummer until you get to work around it..

    7:37 AM <#110345983090235245>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110345983090235245>

Jessta <http://www.blogger.com/profile/4208281> said...

    it's interesting that nobody will have the bandwidth that google has
    to make this work as nice.

    5:09 PM <#110349419587332028>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110349419587332028>

Andy <http://www.blogger.com/profile/3122608> said...

    Can't follow the technical stuff, but have an interest in this
    because I think it is termed a PAL [predictive adaptive lexicon],
    which they tried to use with dyslexics using word-processors.
    Probably dozens of PALprogs out there.

    A cursory Google [ordinary :) ] gives this article with some detail

    http://www2.edc.org/NCIP/library/wp/Newell.htm


    I explain in a little bit more detail what I think in regard to
    Google Search use by dyslexics at

    www.weblogworld.blogspot.com

    5:38 AM <#110353909109169083>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110353909109169083>

ZeroDragonia <http://www.blogger.com/profile/5888836> said...

    /* Knowledge === Power */

    Google's code and concept are pretty cool, but this type of stuff
    has been out there for a while. Of course no one knew how to search
    for it because people didn't know it existed :)

    (searching google for "javascripty / serversidey thingy behind the
    scenes" won't give you good results)

    Either way, I built the PostOfficeBox a few months ago to create a
    generic javascript to serverside functionality and it's up on
    sourceforge. Google's code is impressive, but very specific.

    PostOfficeBox has "multi-threaded" calls with with optional caching,
    timeouts and dynamic functions etc.

    http://pobox.staticsolution.com is where the demo lie's dormant :)

    Good work Señor Jusus...spread the word!

    11:06 AM <#110355877603458793>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110355877603458793>

Anonymous said...

    Ss co-developer of PostOfficeBox, i have a parallel project located at:
    http://mangoduck.org/postofficebox/jsqsocket/demo/1/

    Source Forge progect page:
    http://sourceforge.net/projects/postofficebox/

    When I have time, hopefully soon, I intend to write an autocomplete
    demo nearly identical in function to google suggest, but using
    JsqSocket. The one hangup with this method is it works in all
    "modern" browsers except Safari (as of version 1.2.3), but can be
    implemented to degrade into a normally posting interface when needed.

    11:23 AM <#110355981243674427>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110355981243674427>

mangoduck <http://www.blogger.com/profile/5889377> said...

    Above was me. Forgive my typos!

    11:26 AM <#110355997316470375>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110355997316470375>

Anonymous said...

    Great work!
    I can't believe the anal grammar people that are commenting, it
    gives on the feeling that they couldn't parse the content so picked
    at the grammar. Especially those that chose to repeats grammar
    comments that had already been made.

    Anyhoo Great Work, and keep it up!

    12:32 PM <#110356394379243024>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110356394379243024>

ZeroDragonia <http://www.blogger.com/profile/5888836> said...

    Ok, threading & caching demos are up at
    http://pobox.staticsolution.com now. I'll stop there because the
    other demos, as cool as they are :), would take a long time to show.

    PostOfficeBox is currently being used in a couple of large
    corporations (New York Times subdivision in Florida and a marketing
    corp that I currently work for called Protocol).

    12:43 PM <#110356458730063492>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110356458730063492>

Anonymous said...

    Javascript still sucks. :) As soon as Google decides to make a
    change in their JS file, it's going to take a good week for that
    change to propagate out across the web, what with browsers caching
    that JS file, AOL caching that JS file, etc. And in the meantime,
    lots of people will be seeing a broken Google Suggest page. Not to
    mention the fact that you've got to do double- (or triple) work to
    support older browsers that don't support the XML object. Sure, it's
    a neat feature, but I'm glad I don't have to maintain it. ;)

    1:25 PM <#110356710179435143>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110356710179435143>

Anonymous said...

    about the grammar: i read the ellipses quite naturally as pauses in
    normal conversations. it makes the reading very easy to follow,
    avoiding language constructs in favor of technical content. it gets
    straight to the point on what his impressions are and what the facts
    are.

    my credentials: i was reading lotr before the fifth grade. i had a
    reading diet of 2 stephen king novels per week in grade 7. my poor
    myopic eyes spend roughly 3 hours a day reading. i finished war and
    peace last month. i volunteer my time to tutor adults in literacy.

    and i have no problem with the way this guy writes.

    1:28 PM <#110356729556127675>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110356729556127675>

Anonymous said...

    Thanks for the analysis. I had tried XmlHttp previously but switched
    to background requests in hidden frames, because it works with more
    browsers. Hopefully XmlHttp becomes better supported in the near future.

    As for the grammar Nazis, be sure your grammar is correct before
    complaining ;-)

    And for those who don't think grammar or punctuation matter-- bad
    grammar and punctuation does tend to reflect on the person, and can
    be distracting even if the meaning is discernible.

    Just use a browser with built-in spell checking (like Mozilla with
    extensions) :-)

    1:49 PM <#110356854588551008>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110356854588551008>

ZeroDragonia <http://www.blogger.com/profile/5888836> said...

    Wow... people went a little english crazy back there.

    Just a small comment on the "JavaScript sucks because that stuff is
    cached by the browser" stuff... PostOfficeBox compensates for that,
    so you never use a cached file from the browser.

    http://pobox.staticsolution.com/
    The PostOfficeBox.js file is where all the server connectivity code is.

    3:08 PM <#110357331593307505>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110357331593307505>

Anonymous said...

    Just wonder, how much time did you take to re-write this stuff ?

    10:36 PM <#110360016807799795>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110360016807799795>

Chris <http://www.blogger.com/profile/891156> said...

    Just a note that I've added a short follow-up to this article...

    http://serversideguy.blogspot.com/2004/12/google-suggest-dissected-follow-up.html

    It took a total of 8 hours over 2 evenings to transform the code
    from it's initial state to the end result I got it in. I could have
    gone further, but felt I had reached a pretty good point, and didn't
    want to eat up any more time. :)

    11:08 PM <#110360212053712693>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110360212053712693>

Anonymous said...

    I like this javascript server call-back method, having the server
    return Javascript is a relatively elegant method to do pretty much
    anything. I found a method to do this some time back, using
    invisible IFRAMES the XMLRequest method is a good addition to this
    method. Check out the following
    http://developer.apple.com/internet/webcontent/iframe.html. Maybe
    one day the entire internet will be like one big app.

    5:42 AM <#110362574343966009>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110362574343966009>

Anonymous said...

    Cmon people, quick whining about his spelling or grammer, he did you
    a FREE SERVICE!

    Looks awesome by the way!

    2:20 PM <#110365684706750401>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110365684706750401>

Anonymous said...

    As Ralph Wiggum said: "Me fail English ? That's unpossible"

    Great work Chris... ;)

    2:57 PM <#110365904147095996>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110365904147095996>

Anonymous said...

    I'm just chiming in with my 2 c. Grammar Nazis - BACK OFF! Nobody
    forced you to read this blog. If you don't like it, just take your
    anal selves and move it along.

    There are many of us who appreciate the effort put in and can learn
    from the post without being distracted by the relatively minor
    punctuation slip-ups.

    Great job with the reverse engineering!

    5:17 PM <#110366746320957455>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110366746320957455>

mangoduck <http://www.blogger.com/profile/5889377> said...

    "As soon as Google decides to make a change in their JS file, it's
    going to take a good week for that change to propagate out across
    the web, what with browsers caching that JS file, AOL caching that
    JS file, etc. And in the meantime, lots of people will be seeing a
    broken Google Suggest page."

    Following that same logic, you can't change ANYTHING on the web --
    scripts, images, markup, shockwave and flash, css -- without fear of
    it being cached somewhere. It's not realistic to hold back a great
    feature or critical change because some user agents cache too
    aggressively.

    Also, if it does break, what do you get? A working search page like
    we have now. Is that so bad? Much of the elegance of this feature is
    that it can never hinder any other functionality.

    "Not to mention the fact that you've got to do double- (or triple)
    work to support older browsers that don't support the XML object."

    Not even double. For agents lacking xmlhttprequest, Google Suggest
    uses an iframe stashed ten thousand pixels offscreen as a target for
    the lookup-as-you-type requests and copies the resulting innerhtml
    from it, evaluating that text as javascript code. The innerhtml is
    accessible to the script because the iframe src is within the same
    domain. The only additions to the main script are a flag signifying
    the presence/absence of xmlhttprequest, and functions to pipe the
    data through the iframe instead of running the request. There is
    only one set of functions to capture events and display the list.

    The only advantage I see to xmlhttprequest is it runs at a lower
    level than JsqSocket/PostOfficeBox would (dynamic script objects)
    which makes it very responsive, though only as responsive as any
    http request can be.

    The turnoffs of this method for me are limited backward
    compatibility, and the fact that the object was a product of MS and
    related to activex to start with. Only more recently have other
    vendors picked it up, presumably because they thought it couldn't
    hurt to do so.

    7:44 PM <#110367627123776936>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110367627123776936>

Anonymous said...

    Great Work and its very good you share ur finding.....Hats Off to u

    6:04 AM <#110371345446454617>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110371345446454617>

Anonymous said...

    Chris> I tried to have my browser go through a local proxy
    Chris> server, but it appears that the XMLHttp object doesn't
    Chris> use the browsers proxy when communicating (which means
    Chris> that this might not work if you're behind a proxy
    server... Can people confirm this??) ...

    No, I can't confirm this. The opposite happens:
    I'm behind a corporate firewall and all works ok

    Anton Tagunov

    6:17 AM <#110371426210940022>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110371426210940022>

Anonymous said...

    You guys have clearly never used convea.

    We used the XMLHTTP object some years ago to create a web based
    conferencing system that does not require a page refresh to send or
    retrieve messages.

    The technology is nothing new; the implementation however is sweet!

    10:48 AM <#110373051916986651>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110373051916986651>

Anonymous said...

    This is Durrani from India.

    It does work behind the proxy also...

    Cool google...

    3:13 AM <#110378959354839994>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110378959354839994>

Anonymous said...

    This post has been removed by a blog administrator.

    4:04 AM <#110379269845392850>
Anonymous said...

    This post has been removed by a blog administrator.

    5:55 AM <#110379934434010888>
Anonymous said...

    Yeah, great work man! It's amazing! =]]]

    Hum... have you ever seen that:
    http://gmail.google.com/gmail?view=page&name=js&ver=f81f5040341823b5

    I've looked fast, but i think that has something nice there... =]

    bohzzu@gmail.com

    2:59 PM <#110383197507750421>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110383197507750421>

Anonymous said...

    There is nothing new about what google is doing. There has been an
    xml-rpc lib for js for a while now.

    http://www.vcdn.org/Public/XMLRPC/

    10:51 AM <#110390348853662421>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110390348853662421>

Anonymous said...

    Woah!! Great work! Thanks for sharing your findings...

    11:29 AM <#110390578882013920>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110390578882013920>

Alan <http://www.blogger.com/profile/3359738> said...

    Wonderful dissection. I propose you to dissect this other trivial
    (or at least to me when I first look at it) image protection that
    Google have used for their "Google Print" pages.

    For instance, a search on google for "books on mastering digital
    photography
    <http://www.blogger.com/r?http%3A%2F%2Fwww.google.com%2Fsearch%3Fq%3Dbooks%2Bon%2Bmastering%2Bdigital%2Bphotography>"
    brings you several "Book results".

    Click any of them, and now try to obtain the image of the page.
    (Getting it from your browser cache would be cheating.) If you check
    the page source, you'll see they use some very confusing techniques
    to protect the images on the "Google Print" pages. I'd love to learn
    how and what they are doing exactly.

    Cheers,
    -- Alan

    1:11 PM <#110391188240726879>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110391188240726879>

gavi <http://www.blogger.com/profile/637814> said...

    I just finished implementing Google suggest for a dictionary database.

    http://www.objectgraph.com/dictionary
    <http://www.blogger.com/r?http%3A%2F%2Fwww.objectgraph.com%2Fdictionary>The
    code is clean and you could see it by using "View Source" or there
    is a link "how does it work?" where you will see the server code aswell.

    The dictionary database is on an SQL server (total of 18000+ words)
    with an index on the word column.

    3:29 PM <#110400655501491213>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110400655501491213>

Anonymous said...

    Alan -

    The page images are implemented as background images of an area.
    I've seen this before, so I only got far enough into it to confirm
    my suspicion that this is what is going on with Google Print. The
    most common way to do it is to have a table cell with height and
    width set to the size of the image, and the background picture be
    the image URL. Then, use a clear GIF of the same size as the actual
    picture as the contents of the table cell. If/when the user right
    clicks on the "image" they see, they'll be clicking on the clear
    spacer GIF, and the background image will be slightly more
    protected. Google uses the same idea, it appears, with CSS instead
    of tables.

    12:35 PM <#110416891918590232>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110416891918590232>

Anonymous said...

    I found the following error in the script:

    This piece of code:

    if(event&&event.keyCode==8){
    if(X&&(_inputField.createTextRange&&(event.srcElementa&&(bb(_inputField)==0&&lb(_inputField)==0)))){



    Should be:


    if(event&&event.keyCode==8){
    if(X&&(_inputField.createTextRange&&(event.srcElement==_inputField&&(bb(_inputField)==0&&lb(_inputField)==0)))){

    4:44 PM <#110427027403095888>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110427027403095888>

Jono <http://www.blogger.com/profile/3203241> said...

    I took the decompressed script and created a working demo. The only
    trouble I'm having is related to the css. In IE6 it looks like the
    right alignment for the # of search results only works in
    quirksmode. Has anyone came up with a workaround?

    6:39 PM <#110427716320030804>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110427716320030804>

Anonymous said...

    I found a bug with the Google suggest feature:

    Enter a name to search. Example: apple

    Tab all the way back to the search field using the tab key

    The value of the search field disappears ! (verified with Internet
    Explorer 6 and Firefox 1)

    6:42 PM <#110427737423208760>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110427737423208760>

Anonymous said...

    Here is the code to modify to prevent the tabbing issue mentionned
    above (ascii value of tab is 9):

    1/[snip]
    if(X&&_eventKeycode!=0&&_eventKeycode!=9){
    if(N>0&&v!=-1) {
    V=V.substring(0,v);
    }
    [snip]

    2/
    [snip]
    }else if(eventCode==9){
    return false
    }
    [snip]

    7:22 PM <#110427977364663781>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110427977364663781>

Anonymous said...

    gmail is also using XMLHttp to post the data back to the server.
    Infact we had developed a commercial application entirely on XMLHttp
    three years back. But performance was miserable. Guess its time to
    learn from google

    5:42 AM <#110431696431719343>
    <http://www.blogger.com/delete-comment.do?blogID=7038614&postID=110431696431719343>


Post a Comment
<http://www.blogger.com/comment.g?blogID=7038614&postID=110300088864427760>

<< Home <http://serversideguy.blogspot.com>


    About Me

My Photo <http://www.blogger.com/profile/891156>
    *Name:*Chris
    *Location:*Ottawa, Ontario, Canada

View my complete profile <http://www.blogger.com/profile/891156>


    Previous Posts

    * Starting a business - things to consider...
      <http://serversideguy.blogspot.com/2004/09/starting-business-things-to-consider.html>
    * Fighting a bazillion ways to spell v1*A*g*ra...
      <http://serversideguy.blogspot.com/2004/09/fighting-bazillion-ways-to-spell.html>
    * My spam fighting idea...
      <http://serversideguy.blogspot.com/2004/09/my-spam-fighting-idea.html>
    * Making my ultra-cool Mozilla WebService IMDB query button...
      <http://serversideguy.blogspot.com/2004/08/making-my-ultra-cool-mozilla.html>
    * Cool Web Service functions in Mozilla...
      <http://serversideguy.blogspot.com/2004/08/cool-web-service-functions-in-mozilla.html>
    * Unit testing our server code - List of tools we're using... - Part
      2
      <http://serversideguy.blogspot.com/2004/07/unit-testing-our-server-code-list-of.html>
    * 100% code coverage no guarentee...
      <http://serversideguy.blogspot.com/2004/07/100-code-coverage-no-guarentee.html>
    * Integrating our bug tracking system with CVS...
      <http://serversideguy.blogspot.com/2004/07/integrating-our-bug-tracking-system.html>
    * Unit testing our server code - List of tools we're using...
      <http://serversideguy.blogspot.com/2004/06/unit-testing-our-server-code-list-of.html>
    * My Search For a New Dedicated Linux Server...
      <http://serversideguy.blogspot.com/2004/06/my-search-for-new-dedicated-linux.html>

<http://feeds.feedburner.com/ChrisJustus-ServerSideGuy>

Powered by Blogger <http://www.blogger.com>

Links - Affiliated With:

    * Alcea Technologies - IT Services & Software
      <http://www.alceatech.com/>
    * Alcea Fast BugTrack - Web-based bug tracking software - Track Bugs
      Now <http://www.fastbugtrack.com/>
    * Alcea Fast IssueTrack - Simple. Effective. Issue Tracking
      <http://www.alceatech.com/issue-tracking/>

Links - Friends With:

    * Plug-in Weblog - Geoff Longman - Spindle, Eclipse Plugin for
      Tapestry <http://jroller.com/page/glongman>

------------------------------------------------------------------------



