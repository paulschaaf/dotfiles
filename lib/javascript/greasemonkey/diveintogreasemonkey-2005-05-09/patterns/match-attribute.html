
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <title>4.6.&nbsp;Doing something for every element with a certain attribute [Dive Into Greasemonkey]</title>
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="stylesheet" href="../css/dig.css" type="text/css">
      <meta http-equiv="Link" content='&lt;../css/modern.css&gt;; type="text/css"; rel=stylesheet, &lt;../css/empty.css&gt;; type="text/css";
      rel=stylesheet'>
      <link rev="made" href="mailto:mark@diveintomark.org">
      <meta name="generator" content="DocBook XSL Stylesheets V1.68.1">
      <meta name="keywords" content="Firefox, Greasemonkey, Javascript, user script, userscript">
      <link rel="start" href="../toc/index.html" title="Dive Into Greasemonkey">
      <link rel="up" href="index.html" title="Chapter&nbsp;4.&nbsp;Common Patterns">
      <link rel="prev" href="iterate-one-element.html" title="4.5.&nbsp;Doing something for every instance of a specific HTML element">
      <link rel="next" href="insert-before.html" title="4.7.&nbsp;Inserting content before an element">
   </head>
   <body id="diveintogreasemonkey-org" class="pattern-certainattribute">
      <div class="z" id="intro">
         <div class="sectionInner">
            <div class="sectionInner2">
               <div class="s">
                  <h1><a href="/" accesskey="1">Dive Into Greasemonkey</a></h1>
                  <p>Teaching an old web new tricks</p>
               </div>
               <div class="s">
                  <ul>
                     <li><a href="../">Home</a> &middot; 
                     </li>
                     <li><a href="../toc/">Table of contents</a> &middot; 
                     </li>
                     <li><a href="../download/">Download</a> &middot; 
                     </li>
                     <li><a href="http://greasemonkey.mozdev.org/">Get Greasemonkey</a></li>
                  </ul>
               </div>
            </div>
         </div>
      </div>
      <div id="main">
         <div id="mainInner">
            <p id="breadcrumb">You are here: <a href="../">Home</a> &#8594; <a href="../toc/index.html">Table of contents</a> &#8594; <a href="index.html">Common Patterns</a> &#8594; <span class="thispage">Doing something for every element with a certain attribute</span></p>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="pattern.certainattribute" class="skip" href="#pattern.certainattribute" title="link to this section"><img src="../images/permalink.gif" alt="[link]" title="link to this section" width="8" height="9"></a> 4.6.&nbsp;Doing something for every element with a certain attribute
                        </h2>
                     </div>
                     <div>
                        <div class="abstract">
                           <h3 class="title"></h3>
                           <p>The single most powerful tool in your Greasemonkey arsenal is the <code class="function">evaluate</code> method, which finds elements, attributes, and text on a page using a query language called XPath.
                           </p>
                        </div>
                     </div>
                  </div>
               </div>
               <p>Let's say, for example, that you wanted to find all the links on a page.  You might consider using <code class="function">document.getElementsByTagName('a')</code>, but then you'll still need to check each element to see if it has an <code class="sgmltag-attribute">href</code> attribute, because the <code class="sgmltag-element">&lt;a&gt;</code> element can also be used for named anchors.
               </p>
               <p>Instead, use Firefox's built-in XPath support to find all the <code class="sgmltag-element">&lt;a&gt;</code> elements that have an <code class="sgmltag-attribute">href</code> attribute.
               </p>
               <div class="example"><a name="example.pattern.certainattribute.a.href" class="skip" href="#example.pattern.certainattribute.a.href" title="link to this example"><img src="../images/permalink.gif" alt="[link]" title="link to this example" width="8" height="9"></a> 
                  <h3 class="title">Example:&nbsp;Find all the links on a page</h3><pre class="programlisting ">var allLinks, thisLink;
allLinks = document.evaluate(
    '//a[@href]',
    document,
    null,
    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
    null);
for (var i = 0; i &lt; allLinks.snapshotLength; i++) {
    thisLink = allLinks.snapshotItem(i);
    // do something with thisLink
}</pre><p>The <code class="methodname">document.evaluate</code> method is the key here.  It takes an XPath query as a string, then a bunch of other parameters I'll explain in a minute.
                      This XPath query finds all the <code class="sgmltag-element">&lt;a&gt;</code> elements that have an <code class="sgmltag-attribute">href</code> attribute, and returns them in random order.  (That is, the first one you get is not guaranteed to be the first link on the
                     page.)  Then you access each found element with the <code class="methodname">allLinks.snapshotItem(i)</code> method.
                  </p>
               </div>
               <p>XPath expressions can do wonderous things.  Here's one that finds <span class="emphasis"><em>any</em></span> element that has a <code class="sgmltag-attribute">title</code> attribute.
               </p>
               <div class="example"><a name="example.pattern.certainattribute.title" class="skip" href="#example.pattern.certainattribute.title" title="link to this example"><img src="../images/permalink.gif" alt="[link]" title="link to this example" width="8" height="9"></a> 
                  <h3 class="title">Example:&nbsp;Find all the elements with a <code class="sgmltag-attribute">title</code> attribute
                  </h3><pre class="programlisting ">var allElements, thisElement;
allElements = document.evaluate(
    '//*[@title]',
    document,
    null,
    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
    null);
for (var i = 0; i &lt; allElements.snapshotLength; i++) {
    thisElement = allElements.snapshotItem(i);
    switch (thisElement.nodeName.toUpperCase()) {
        case 'A':
            // this is a link, do something
            break;
        case 'IMG':
            // this is an image, do something else
            break;
        default:
            // do something with other kinds of HTML elements
    }
}</pre></div>
               <div class="tip">
                  <table class="admon" summary="">
                     <tr>
                        <td class="admonicon"><a href="../appendix/tips.html" title="List of tips"><img alt="[Tip]" src="../images/tip.png" width="24" height="24" title=""></a></td>
                        <td class="admontext">
                           <p>Once you have a reference to an element (like <code class="varname">thisElement</code>), you can use <code class="property">thisElement.nodeName</code> to determine its <acronym title="HyperText Markup Language">HTML</acronym> tag name.  If the page is served as <code class="systemitem">text/html</code>, the tag name is always returned as uppercase, regardless of how it was specified in the original page.  However, if the
                              page is served as <code class="systemitem">application/xhtml+xml</code>, the tag name is always lowercase.  I always use <code class="function">thisElement.nodeName.toUpperCase()</code> and forget about it.
                           </p>
                        </td>
                     </tr>
                  </table>
               </div>
               <p>Here's an XPath query that returns every <code class="sgmltag-element">&lt;div&gt;</code> with a specific <code class="sgmltag-attribute">class</code>.
               </p>
               <div class="example"><a name="example.pattern.certainattribute.sponsoredlink" class="skip" href="#example.pattern.certainattribute.sponsoredlink" title="link to this example"><img src="../images/permalink.gif" alt="[link]" title="link to this example" width="8" height="9"></a> 
                  <h3 class="title">Example:&nbsp;Find all <code class="sgmltag-element">&lt;div&gt;</code>s with a <code class="sgmltag-attribute">class</code> of <code class="literal">sponsoredlink</code></h3><pre class="programlisting ">var allDivs, thisDiv;
allDivs = document.evaluate(
    "//div[@class='sponsoredlink']",
    document,
    null,
    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
    null);
for (var i = 0; i &lt; allDivs.snapshotLength; i++) {
    thisDiv = allDivs.snapshotItem(i);
    // do something with thisDiv
}</pre><p>Note that I used double quotes around the XPath query string, so that I could use single quotes within it.</p>
               </div>
               <p>There are lots of variations of the <code class="methodname">document.evaluate</code> method.  The second parameter (<code class="varname">document</code> in both of the previous examples) can be any element, and the XPath query will only return nodes that are children of that
                  element.  So if you already have a reference to an element (say, from <code class="methodname">document.getElementById</code> or a member of a <code class="methodname">document.getElementsByTagName</code> array), you can restrict the query to search only children of that element.
               </p>
               <p>The third parameter is a reference to a namespace resolver function, which is only useful if you care about writing user scripts
                  that work on pages served with the <code class="systemitem">application/xhtml+xml</code> media type.  If you don't know what that means, don't worry about it; there aren't very many pages like that and you probably
                  won't run into one.  <a href="http://www-jcsu.jesus.cam.ac.uk/~jg307/mozilla/xpath-tutorial.html">Mozilla XPath documentation</a> explains how to use it, if you really want to know.
               </p>
               <p>The fourth parameter is how you want your results returned.  The previous two examples both use <code class="constant">XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE</code>, which returns elements in random order.  I use this 99% of the time, but if for some reason you wanted to make sure that
                  you got elements back in exactly the order in which they appear in the page, you can use <code class="constant">XPathResult.ORDERED_NODE_SNAPSHOT_TYPE</code> instead.  <a href="http://www-jcsu.jesus.cam.ac.uk/~jg307/mozilla/xpath-tutorial.html">Mozilla XPath documentation</a> gives examples of some other variations as well.
               </p>
               <p>The fifth parameter can be used to merge the results of two XPath queries.  Pass in the result of a previous call to <code class="methodname">document.evaluate</code>, and it will return the combined results of both queries.  The previous two examples both use <code class="constant">null</code>, meaning that we are only interested in the single XPath query defined in the first parameter.
               </p>
               <p>Got all that?  XPath can be as simple or as complicated as you like.  I urge you to read <a href="http://www.zvon.org/xxl/XPathTutorial/General/examples.html">this excellent XPath tutorial</a> to learn more about XPath syntax.  As for the other parameters to <code class="methodname">document.evaluate</code>, I rarely use them except as you've already seen here.  In fact, you can define a function to encapsulate them.
               </p>
               <div class="example"><a name="example.pattern.xpath.function" class="skip" href="#example.pattern.xpath.function" title="link to this example"><img src="../images/permalink.gif" alt="[link]" title="link to this example" width="8" height="9"></a> 
                  <h3 class="title">Example:&nbsp;The <code class="function">xpath</code> function
                  </h3><pre class="programlisting ">function xpath(query) {
    return document.evaluate(query, document, null,
        XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
}</pre><p>Now you can simply call <code class="function">xpath('//a[@href]')</code> to get all the links on the page, or <code class="function">xpath('//*[@title]')</code> to get all the elements with a <code class="sgmltag-attribute">title</code> attribute.  You'll still need to use the <code class="methodname">snapshotItem</code> method to access each item in the results; it's not a regular Javascript array.
                  </p>
               </div>
               <div class="usedby">
                  <h3>Real examples</h3>
                  <ul>
                     <li><a href="http://diveintogreasemonkey.org/download/accessbar.user.js">Access Bar</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/betterdir.user.js">BetterDir</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/blogdex-display-title.user.js">Blogdex Display Title</a></li>
                     <li><a href="http://diveintomark.org/projects/butler/butler.user.js">Butler</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/frownies.user.js">Frownies</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/offsiteblank.user.js">Offsite Blank</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/rottenreviews.user.js">Rotten Reviews</a></li>
                     <li><a href="http://diveintogreasemonkey.org/download/stopthepresses.user.js">Stop The Presses</a></li>
                  </ul>
               </div>
               <div class="furtherreading"><a href="../appendix/furtherreading.html" title="List of &#8220;further reading&#8221; links">
                     <h3>Further reading</h3></a><ul>
                     <li><a href="http://www-jcsu.jesus.cam.ac.uk/~jg307/mozilla/xpath-tutorial.html">Mozilla XPath documentation</a></li>
                     <li><a href="http://www.zvon.org/xxl/XPathTutorial/General/examples.html">XPath tutorial by example</a></li>
                     <li><a href="http://www.xulplanet.com/references/objref/XPathResult.html">XPathResult reference</a></li>
                  </ul>
               </div>
            </div>
            <div style="float: left">&#8592;&nbsp;<a class="NavigationArrow" href="iterate-one-element.html">Doing something for every instance of a specific HTML element</a></div>
            <div style="text-align: right"><a class="NavigationArrow" href="insert-before.html">Inserting content before an element</a>&nbsp;&#8594;
            </div>
            <hr style="clear:both">
            <div class="footer">
               <p class="copyright">Copyright &copy; 2005 Mark Pilgrim &middot; <a title="send me feedback about this book" href="mailto:mark@diveintomark.org">mark@diveintomark.org</a> &middot; <a href="../license/gpl.html" title="GNU General Public License">Terms of use</a></p>
            </div>
         </div>
      </div>
   </body>
</html>