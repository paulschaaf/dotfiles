
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <title>5.6.&nbsp;Case study: Frownies [Dive Into Greasemonkey]</title>
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="stylesheet" href="../css/dig.css" type="text/css">
      <meta http-equiv="Link" content='&lt;../css/modern.css&gt;; type="text/css"; rel=stylesheet, &lt;../css/empty.css&gt;; type="text/css";
      rel=stylesheet'>
      <link rev="made" href="mailto:mark@diveintomark.org">
      <meta name="generator" content="DocBook XSL Stylesheets V1.68.1">
      <meta name="keywords" content="Firefox, Greasemonkey, Javascript, user script, userscript">
      <link rel="start" href="../toc/index.html" title="Dive Into Greasemonkey">
      <link rel="up" href="index.html" title="Chapter&nbsp;5.&nbsp;Case Studies">
      <link rel="prev" href="dumbquotes.html" title="5.5.&nbsp;Case study: Dumb Quotes">
      <link rel="next" href="zoomtextarea.html" title="5.7.&nbsp;Case study: Zoom Textarea">
   </head>
   <body id="diveintogreasemonkey-org" class="casestudy-frownies">
      <div class="z" id="intro">
         <div class="sectionInner">
            <div class="sectionInner2">
               <div class="s">
                  <h1><a href="/" accesskey="1">Dive Into Greasemonkey</a></h1>
                  <p>Teaching an old web new tricks</p>
               </div>
               <div class="s">
                  <ul>
                     <li><a href="../">Home</a> &middot; 
                     </li>
                     <li><a href="../toc/">Table of contents</a> &middot; 
                     </li>
                     <li><a href="../download/">Download</a> &middot; 
                     </li>
                     <li><a href="http://greasemonkey.mozdev.org/">Get Greasemonkey</a></li>
                  </ul>
               </div>
            </div>
         </div>
      </div>
      <div id="main">
         <div id="mainInner">
            <p id="breadcrumb">You are here: <a href="../">Home</a> &#8594; <a href="../toc/index.html">Table of contents</a> &#8594; <a href="index.html">Case Studies</a> &#8594; <span class="thispage">Case study: Frownies</span></p>
            <div class="section" lang="en">
               <div class="titlepage">
                  <div>
                     <div>
                        <h2 class="title"><a name="casestudy.frownies" class="skip" href="#casestudy.frownies" title="link to this section"><img src="../images/permalink.gif" alt="[link]" title="link to this section" width="8" height="9"></a> 5.6.&nbsp;Case study: Frownies
                        </h2>
                     </div>
                     <div>
                        <h3 class="subtitle">Converting graphical smilies to text</h3>
                     </div>
                     <div>
                        <div class="abstract">
                           <h3 class="title"></h3>
                           <p>Frownies came to be in response to a joke.  Someone on the <a href="http://greasemonkey.mozdev.org/list.html">Greasemonkey mailing list</a> announced that they had developed a user script to convert ASCII &#8220;<span class="quote">smilies</span>&#8221; like <code class="literal">:-)</code> to their graphical equivalents.  Someone else responded, wondering how long it would take for someone to do the reverse:
                              convert graphical smilies back to text.
                           </p>
                        </div>
                     </div>
                  </div>
               </div>
               <p>For the record, it took me about 20 minutes.  Most of the time was spent researching publishing software that auto-generated
                  graphical smilies, and compiling a comprehensive list of variations.
               </p>
               <p>This script relies on the fact that most publishing software that generates graphical smilies puts the text equivalent in
                  the <code class="sgmltag-attribute">alt</code> attribute of the <code class="sgmltag-element">&lt;img&gt;</code> element.  So really what this script does is replace images with their ALT text, if the ALT text matches one of a list of
                  pre-defined constants.
               </p>
               <div class="example"><a name="example.casestudy.frownies" class="skip" href="#example.casestudy.frownies" title="link to this example"><img src="../images/permalink.gif" alt="[link]" title="link to this example" width="8" height="9"></a> 
                  <h3 class="title">Example:&nbsp;<a href="http://diveintogreasemonkey.org/download/frownies.user.js" title="Download Frownies"><code class="filename">frownies.user.js</code></a></h3><pre class="programlisting ">// ==UserScript==
// @name          Frownies
// @namespace     http://diveintogreasemonkey.org/download/
// @description   convert graphical smilies to their text equivalents
// @include       *
// ==/UserScript==

var smilies, images, img, replacement;
smilies = [":)", ":-)" ":-(", ":(", ";-)", ";)", ":-D", ":D", ":-/",
    ":/", ":X", ":-X", ":\"&gt;", ":P", ":-P", ":O", ":-O", "X-(",
    "X(", ":-&gt;", ":&gt;", "B-)", "B)", "&gt;:)", ":((", ":(((", ":-((",
    ":))", ":-))", ":-|", ":|", "O:-)", "O:)", ":-B", ":B", "=;",
    "I)", "I-)", "|-)", "|)", ":-&amp;", ":&amp;", ":-$", ":$", "[-(", ":O)",
    ":@)", "3:-O", ":(|)", "@};-", "**==", "(~~)", "*-:)", "8-X",
    "8X", "=:)", "&lt;):)", ";;)", ":*", ":-*", ":S", ":-S", "/:)",
    "/:-)", "8-|", "8|", "8-}", "8}", "(:|", "=P~", ":-?", ":?",
    "#-O", "#O", "=D&gt;", "~:&gt;", "%%-", "~O)", ":-L", ":L", "[-O&lt;",
    "[O&lt;", "@-)", "@)", "$-)", "$)", "&gt;-)", ":-\"", ":^O", "B-(",
    "B(", ":)&gt;-", "[-X", "[X", "\\:D/", "&gt;:D&lt;", "(%)", "=((", "#:-S",
    "#:S", "=))", "L-)", "L)", "&lt;:-P", "&lt;:P", ":-SS", ":SS", ":-W",
    ":W", ":-&lt;", ":&lt;", "&gt;:P", "&gt;:-P", "&gt;:/", ";))", ":-@", "^:)^",
    ":-J", "(*)", ":GRIN:", ":-)", ":SMILE:", ":SAD:", ":EEK:",
    ":SHOCK:", ":???:", "8)", "8-)", ":COOL:", ":LOL:", ":MAD:",
    ":RAZZ:", ":OOPS:", ":CRY:", ":EVIL:", ":TWISTED:", ":ROLL:",
    ":WINK:", ":!:", ":?:", ":IDEA:", ":ARROW:", ":NEUTRAL:",
    ":MRGREEN:"];
images = document.evaluate(
    '//img[@alt]',
    document,
    null,
    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
    null);
for (var i = 0; i &lt; images.snapshotLength; i++) {
    img = images.snapshotItem(i);
    alt = img.alt.toUpperCase();
    for (var j in smilies) {
        if (alt == smilies[j]) {
            replacement = document.createTextNode(alt);
            img.parentNode.replaceChild(replacement, img);
        }
    }
}</pre></div>
               <p>The code breaks down into four steps:</p>
               <div class="orderedlist">
                  <ol type="1">
                     <li>Define a list of smilies (as text strings).</li>
                     <li>Find all the images on the page that contain an <code class="sgmltag-attribute">alt</code> attribute.
                     </li>
                     <li>For each image, check whether the ALT text matches any of the list of ASCII smilies.</li>
                     <li>If it matches, replace the <code class="sgmltag-element">&lt;img&gt;</code> element with a text node that contains only the ASCII smily.
                     </li>
                  </ol>
               </div>
               <p>The first step simply defines a list, using Javascript's <code class="literal">[ ]</code> syntax.
               </p>
               <div class="informalexample"><pre class="programlisting ">smilies = [":)", ":-)" ":-(", ":(", ";-)", ";)", ":-D", ":D", ":-/",
    ":/", ":X", ":-X", ":\"&gt;", ":P", ":-P", ":O", ":-O", "X-(",
    "X(", ":-&gt;", ":&gt;", "B-)", "B)", "&gt;:)", ":((", ":(((", ":-((",
    ":))", ":-))", ":-|", ":|", "O:-)", "O:)", ":-B", ":B", "=;",
    "I)", "I-)", "|-)", "|)", ":-&amp;", ":&amp;", ":-$", ":$", "[-(", ":O)",
    ":@)", "3:-O", ":(|)", "@};-", "**==", "(~~)", "*-:)", "8-X",
    "8X", "=:)", "&lt;):)", ";;)", ":*", ":-*", ":S", ":-S", "/:)",
    "/:-)", "8-|", "8|", "8-}", "8}", "(:|", "=P~", ":-?", ":?",
    "#-O", "#O", "=D&gt;", "~:&gt;", "%%-", "~O)", ":-L", ":L", "[-O&lt;",
    "[O&lt;", "@-)", "@)", "$-)", "$)", "&gt;-)", ":-\"", ":^O", "B-(",
    "B(", ":)&gt;-", "[-X", "[X", "\\:D/", "&gt;:D&lt;", "(%)", "=((", "#:-S",
    "#:S", "=))", "L-)", "L)", "&lt;:-P", "&lt;:P", ":-SS", ":SS", ":-W",
    ":W", ":-&lt;", ":&lt;", "&gt;:P", "&gt;:-P", "&gt;:/", ";))", ":-@", "^:)^",
    ":-J", "(*)", ":GRIN:", ":-)", ":SMILE:", ":SAD:", ":EEK:",
    ":SHOCK:", ":???:", "8)", "8-)", ":COOL:", ":LOL:", ":MAD:",
    ":RAZZ:", ":OOPS:", ":CRY:", ":EVIL:", ":TWISTED:", ":ROLL:",
    ":WINK:", ":!:", ":?:", ":IDEA:", ":ARROW:", ":NEUTRAL:",
    ":MRGREEN:"];</pre></div>
               <p>Next I search the page for all <code class="sgmltag-element">&lt;img&gt;</code> elements with an <code class="sgmltag-attribute">alt</code> attribute, using an XPath query.  See <a href="../patterns/match-attribute.html" title="4.6.&nbsp;Doing something for every element with a certain attribute">Doing something for every element with a certain attribute</a> for more details on XPath queries.
               </p>
               <div class="informalexample"><pre class="programlisting ">images = document.evaluate(
    '//img[@alt]',
    document,
    null,
    XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,
    null);</pre></div>
               <p>Step 3 loops through all these <code class="sgmltag-element">&lt;img&gt;</code> elements, and checks whether the <code class="sgmltag-attribute">alt</code> attribute matches any of my defined smilies.  Because some smilies contain letters, I use the <code class="methodname">toUpperCase()</code> method to convert the <code class="sgmltag-attribute">alt</code> attribute to uppercase before comparing.
               </p>
               <div class="informalexample"><pre class="programlisting ">for (var i = 0; i &lt; images.snapshotLength; i++) {
    img = images.snapshotItem(i);
    alt = img.alt.toUpperCase())
    for (var j in smilies) {
        if (alt == smilies[j]) {
            // ...
        }
    }
}</pre></div>
               <p>Finally, I create a new text node with the text of the smily, and replace the existing <code class="sgmltag-element">&lt;img&gt;</code> element.  See <a href="../patterns/replace-element.html" title="4.10.&nbsp;Replacing an element with new content">Replacing an element with new content</a> for more details.
               </p>
               <div class="informalexample"><pre class="programlisting ">            replacement = document.createTextNode(alt);
            img.parentNode.replaceChild(replacement, img);</pre></div>
               <div class="download">
                  <h3>Download</h3>
                  <ul>
                     <li><a href="http://diveintogreasemonkey.org/download/frownies.user.js"><code class="filename">frownies.user.js</code></a></li>
                  </ul>
               </div>
               <div class="seealso">
                  <h3>See also</h3>
                  <ul>
                     <li><a href="../patterns/match-attribute.html" title="4.6.&nbsp;Doing something for every element with a certain attribute">Doing something for every element with a certain attribute</a></li>
                     <li><a href="../patterns/replace-element.html" title="4.10.&nbsp;Replacing an element with new content">Replacing an element with new content</a></li>
                  </ul>
               </div>
            </div>
            <div style="float: left">&#8592;&nbsp;<a class="NavigationArrow" href="dumbquotes.html">Case study: Dumb Quotes</a></div>
            <div style="text-align: right"><a class="NavigationArrow" href="zoomtextarea.html">Case study: Zoom Textarea</a>&nbsp;&#8594;
            </div>
            <hr style="clear:both">
            <div class="footer">
               <p class="copyright">Copyright &copy; 2005 Mark Pilgrim &middot; <a title="send me feedback about this book" href="mailto:mark@diveintomark.org">mark@diveintomark.org</a> &middot; <a href="../license/gpl.html" title="GNU General Public License">Terms of use</a></p>
            </div>
         </div>
      </div>
   </body>
</html>